# 分离I/O流
## 分离流的好处
之前我们已经介绍过两个分离I/O流的方法：
1、利用fork()创造子进程进行I/O流分离（复制了套接字）
2、利用2次fdopen()函数创建了读模式File指针和写模式File指针两个指针，进行I/O流分离（没有复制套接字）

优点：
1. 通过分开输入过程（代码）和输出过程降低实现难度
2. 与输入无关的输出操作可以提高速度

fdopen分离流的目的：
1. 为了将FILE指针按读模式和写模式加以区分
2. 可以通过区分读写模式降低实现难度
3. 通过区分I/O缓冲提高缓冲性能

## fdopen流分离带来的问题

前述的fdopen存在些许问题：
如果只关闭writefp一个读取的模式指针FILE，那么writefp和readfp会同时被关闭。
于是半关闭就成为我们讨论的问题。

### 终止流无法半关闭的原因
1. 两个FILE指针与fd和套接字间的关系
![11.png](0)

2. 如果关闭了其中一个FILE指针就会导致如下情况
![12.png](1)
套接字直接被销毁了。

3. 此处我们复制一个文件描述符，然后再销毁写模式指针（**主要目的是要关闭写模式的标准缓存**，以防资源浪费）
![13.png](2)

4. 最后一步便是用shutdown函数半关闭其I/O流，由于两个读模式指针进行文件描述符转换后都指向同一个套接字，所以shtdown读或写模式转换的fd都没有问题。
