# TCP原理
## TCP套接字中的I/O缓冲
- I/O缓冲在每个TCP套接字中单独存在
- I/O缓冲在创建套接字时自动生成
- 即使关闭套接字仍然会传输遗留在输出缓冲区中的数据
- 关闭套接字会丢失输入缓冲区中的数据
- ![tcp缓冲](https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1550906082822&di=834dd47fb0f682f3cbc697f0a5fdf584&imgtype=0&src=http%3A%2F%2Fseo-1255598498.file.myqcloud.com%2Ffull%2Fea521c12d6460d92fa11c05d0c26b35677e61dc8.jpg)

## TCP内部工作原理1：与对方套接字建立连接
**三次握手**
![TCP三次握手](https://images2017.cnblogs.com/blog/985821/201708/985821-20170802101806802-1497343688.png)
- 客户端发出syn=1，请求同步；并且发出序列seq=x，以及空的ACK信号
- 服务器收到，同时发出同步信号syn=1；并确认，发出ACK=1信号,以及确认号akc=x+1（要求客户接下来发x+1的序列包），seq=y
- 客户端确认收到后，发送ACK信号，以及seq=x+1序列，以及确认好ack=y+1（告诉服务器收到了序列号为y的序列，接下来可以发序列为y+1的数据包了）

**至于为什么要进行三次握手呢，主要是因为如果两次握手：**
- 客户第一次发的连接请求，滞后
- 客户机没收到服务器返回消息，于是重发连接请求
- 服务器收到第二次连接请求，于是打开端口，与客户机传输消息
- 突然客户机第一次的请求又发到了服务器，服务器打开端口，但是此端口客户一直没用上，就会造成空闲，浪费资源

如果三次连接的话，那么第二次到的
